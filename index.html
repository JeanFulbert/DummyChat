<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link type="text/css" rel="stylesheet" href="style.css" />
    <title>Dummy chat</title>

    <script type="text/javascript">
        var ENTER_KEY = 13;
        var historyBoxByUser = {}

        function onLoad() {
            let historyA = document.getElementById("historyA");
            let historyB = document.getElementById("historyB");

            historyBoxByUser = {
                "A": historyA,
                "B": historyB,
            };

            let messageA = document.getElementById("messageA");
            let messageB = document.getElementById("messageB");

            let sendMessageA = document.getElementById("sendMessageA");
            let sendMessageB = document.getElementById("sendMessageB");

            registerEnterKeyPressToButtonClick(messageA, sendMessageA);
            registerEnterKeyPressToButtonClick(messageB, sendMessageB);
        }

        function addMessageFromUser(textBox, user) {
            if (!textBox.value)
            {
                return;
            }

            let newMessage = {
                user: user,
                message: textBox.value
            };

            for (let userInMapping in historyBoxByUser)
            {
                let htmlMessageBox =
                    userInMapping === user
                    ? buildOwnMessageBox(newMessage)
                    : buildOtherMessageBox(newMessage);
                
                let history = historyBoxByUser[userInMapping];
                history.innerHTML += htmlMessageBox;                
                history.scrollTop = history.scrollHeight;
            }

            textBox.value = "";
        }

        function registerEnterKeyPressToButtonClick(input, button) {
            input.addEventListener("keyup", function(event) {
                event.preventDefault();
                if (input.value) {
                    if (event.keyCode == ENTER_KEY) {
                        button.click();
                    }
                }
            });
        }

        function buildOwnMessageBox(message) {
            return '<p class="ownMessage">' + buildMessage(message) + '</p>';            
        }

        function buildOtherMessageBox(message) {
            return '<p class="otherMessage">' + buildMessage(message) + '</p>';
        }

        function buildMessage(newMessage) {
            return "<em>" + newMessage.user + ": </em> " + newMessage.message + "<br />";
        }

        window.onload = onLoad;
    </script>
</head>

<body>
    <div class="main">
        <div class="chat">
            <header>
                <h1>Chat A</h1>
            </header>

            <p id="historyA" readonly class="history">
            </p>

            <section class="message">
                <div class="send">
                    <input id="messageA" type="text" />
                    <button id="sendMessageA" onclick="addMessageFromUser(messageA, 'A')">Send</button>
                </div>
            </section>
        </div>

        <div class="chat">
            <header>
                <h1>Chat B</h1>
            </header>

            <p id="historyB" readonly class="history">
            </p>

            <section class="message">
                <div class="send">
                    <input id="messageB" type="text" />
                    <button id="sendMessageB" onclick="addMessageFromUser(messageB, 'B')">Send</button>
                </div>
            </section>
        </div>
    </div>
</body>

</html>